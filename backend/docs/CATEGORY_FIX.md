# 分类数据修复文档

## 问题描述
在 v1.6.0 版本之前，通过聊天式记账（ChatExpense）创建的支出记录没有选择分类，导致数据库中大量支出的 `categoryId` 为 NULL，统计分析页面的分类分析显示为空白。

## 问题原因
1. **ChatExpense.tsx** - 确认对话框缺少分类选择器
2. **ExpenseForm.tsx** - 有分类选择器但缺少默认值
3. 后端正确接收和存储 categoryId，但前端未传递

## 修复方案

### 1. 前端代码修复（已完成）
- ✅ ChatExpense.tsx 添加分类选择器，默认选择"其他"分类
- ✅ ExpenseForm.tsx 添加默认分类值
- ✅ 支持AI解析分类名称并自动匹配对应分类ID

### 2. 数据库修复
运行 `fix-categories.sql` 脚本修复历史数据：

```bash
# 连接数据库
psql -U your_username -d tripsum_db

# 执行修复脚本
\i fix-categories.sql
```

脚本功能：
- 查看当前分类数据分布
- 将所有 NULL 分类设置为"其他"
- 可选：基于描述关键词智能分类

### 3. 验证步骤
1. 创建新支出，确认分类被正确保存
2. 查看统计页面，确认分类分析正常显示
3. 通过AI记账，确认分类自动识别功能正常

## 预防措施
1. 所有支出创建入口都必须包含分类选择
2. 设置合理的默认分类（"其他"）
3. 在后端添加分类验证，拒绝无分类的支出（可选）

## 版本记录
- v1.6.0 - 2025-09-01 修复分类数据问题