# 管理员删除行程功能测试计划

## 功能概述
实现了管理员删除行程的完整功能，包括前端UI和后端API的完整集成。

## 已实现功能

### ✅ 后端功能（已存在）
- **API端点**: `DELETE /api/trips/:id`
- **权限验证**: 仅管理员可以删除行程
- **数据清理**: 删除行程时会清理所有关联数据（成员、支出、分类等）
- **WebSocket通知**: 删除后通知相关用户
- **错误处理**: 完善的异常处理机制

### ✅ 前端功能（新实现）
- **删除入口**: 管理员浮动按钮 → ActionSheet → "🗑️ 删除行程"
- **二次确认**: 显示行程名称和警告信息的确认对话框
- **加载状态**: 删除过程中显示"正在删除行程..."
- **成功处理**: 删除成功后跳转到行程列表页面
- **错误处理**: 删除失败时显示友好提示

## 测试步骤

### 准备工作
1. 启动后端服务：`cd backend && npm run dev`
2. 启动前端服务：`cd frontend && npm run dev`
3. 创建一个测试行程，确保当前用户是管理员

### 测试场景

#### 场景1: 管理员删除行程（正常流程）
1. **进入行程详情页面**
   - 以管理员身份登录
   - 进入一个自己创建的行程

2. **触发删除操作**
   - 点击右下角浮动按钮（加号图标）
   - 在弹出的ActionSheet中选择"🗑️ 删除行程"

3. **确认删除**
   - 验证确认对话框显示行程名称
   - 点击"确认"按钮

4. **验证结果**
   - 显示"正在删除行程..."加载状态
   - 删除成功后显示"行程已删除"提示
   - 自动跳转到行程列表页面
   - 确认行程从列表中消失

#### 场景2: 非管理员用户（权限测试）
1. **切换到普通成员账号**
2. **进入行程详情页面**
3. **验证删除选项不可见**
   - 点击浮动按钮
   - 确认ActionSheet中没有"删除行程"选项

#### 场景3: 删除失败处理
1. **模拟网络错误**（可选）
   - 断开网络或停止后端服务
   - 尝试删除行程
   - 验证显示"删除失败，请重试"提示

#### 场景4: 取消删除操作
1. **触发删除操作**
2. **在确认对话框中点击"取消"**
3. **验证没有任何删除操作发生**

## 预期结果

### ✅ 成功标准
- 管理员可以看到并使用删除功能
- 非管理员用户看不到删除选项
- 删除前有明确的确认提示
- 删除过程有加载状态指示
- 删除成功后有明确反馈
- 删除失败时有错误提示
- 删除后正确跳转到行程列表

### 🔒 安全验证
- 后端API验证用户权限（仅管理员）
- 前端UI根据角色显示/隐藏功能
- 删除操作需要二次确认

## UI/UX 特性
- **视觉标识**: 使用垃圾桶图标(🗑️)明确表示删除操作
- **操作确认**: 显示具体行程名称的确认对话框
- **警告信息**: 明确告知删除后无法恢复
- **状态反馈**: 完整的加载、成功、失败状态提示
- **流畅跳转**: 删除成功后自动返回行程列表

## 技术实现
- **权限控制**: 基于用户角色的功能显示
- **状态管理**: 使用Zustand store管理删除状态
- **API集成**: 复用现有的deleteTrip服务
- **用户反馈**: 使用Toast和Dialog组件

## 注意事项
- 删除是物理删除，无法恢复
- 删除行程会同时删除所有关联数据
- 只有行程管理员可以执行删除操作
- 建议在实际使用中定期备份重要数据