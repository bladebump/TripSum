# 更新日志

所有关于TripSum项目的重要更改都记录在此文件中。

## [1.8.0] - 2025-09-04
### 🎯 金额精度优化
#### 新增功能
- **Decimal.js集成**: 彻底解决JavaScript浮点数精度问题
- **统一金额处理**: 前后端统一使用Decimal.js进行金额计算
- **精确到分**: 所有金额计算精确到小数点后两位

#### 后端改进
- 创建统一的AmountUtil工具类 (`/backend/src/utils/decimal.ts`)
- 重构4个核心服务文件，移除29处toNumber()调用
- 添加完整的单元测试（39个测试用例）
- 添加集成测试覆盖7个业务场景

#### 前端改进  
- 创建前端AmountUtil工具类 (`/frontend/src/utils/decimal.ts`)
- 替换6处parseFloat()调用为精确计算
- 添加单元测试（26个测试用例）
- 统一用户输入金额的解析逻辑

#### 修复问题
- ✅ 0.1 + 0.2 现在正确等于 0.30
- ✅ AA制分账精确处理（1000元3人分 = 333.33, 333.33, 333.34）
- ✅ 百分比分摊精确到分，无累计误差
- ✅ 大金额（9,999,999.99）计算无精度损失
- ✅ 基金池余额计算精度问题

## [1.7.0] - 2025-09-01
### 📊 Excel导出功能
#### 新增功能
- **完整Excel导出**: 支持5个工作表（总览、支出、基金、成员财务、结算方案）
- **后端导出服务**: 集成exceljs库，支持多工作表和格式化
- **前端集成**: 在行程详情页面添加导出按钮
- **数据本地化**: 优化中文显示和日期格式

## [1.6.0] - 2025-09-01
### 🔧 代码优化和清理
#### 优化改进
- 清理无用的AI总结PDF导出相关代码
- 移除TripStatistics冗余页面和底部导航标签
- 修复React hooks使用问题
- 优化AI解析逻辑，移除不必要的计算工具调用
- 修复人均金额计算和中文日期显示问题
- 修复consumptionDate显示问题

## [1.5.2] - 2025-09-02
### 🐛 修复部署问题
#### 修复
- 解决首次部署数据库迁移P3005错误
- 智能启动脚本自动检测并处理首次部署/更新部署场景
- 修复manage.sh中DOCKER_COMPOSE_CMD变量作用域问题
#### 新增
- 新增部署命令：`init`首次部署，`clean`清理数据
- 优化初始化流程：分离数据库结构创建和数据初始化

## [1.5.1] - 2025-09-01
### 📦 架构简化
#### 优化改进
- 从9个配置文件简化为2个核心文件
- 开发环境完全本地化，无需Docker依赖
- 一键生产部署：自动Git同步，智能环境检查
- 优化CORS和Nginx配置，支持IP直接访问
- 删除MinIO和多余部署文档，专注核心功能

## [1.5.0] - 2025-08-29
### 🏗️ 架构重构
#### 重大改进
- **架构迁移**: 完成userId到memberId架构迁移，统一标识体系
- **结算优化**: 管理员中心化结算，所有结算通过管理员节点
- **性能提升**: getUserTrips减少90%+数据传输量
- **测试体系**: 搭建Jest(后端)+Vitest(前端)完整测试框架
#### 修复
- 修复虚拟成员显示问题
- 修复余额计算精度问题
- 修复成员确认对话框关闭问题
#### 文档
- 更新API文档反映新架构
- 添加技术架构说明文档

## [1.4.0] - 2025-08-28
### 🔄 API架构重构
#### 优化改进
- **API整合**: 统一统计API，优化数据结构
- **统计增强**: 新增成员财务详情，完善基金池状态追踪
- **计算升级**: 重构余额计算逻辑，支持复杂场景
- **服务优化**: 统一前后端数据结构，提升维护性
- **API精简**: 从28个接口优化至20个
#### 修复
- 修复基金贡献解析（正数金额）
- 统一虚拟和真实成员处理逻辑
- 支持累计基金缴纳

## [1.3.0] - 2025-08-27
### 💰 双模式支付系统
#### 新增功能
- **基金池支付**: 创新的基金池+垫付混合管理模式
- **AI计算器**: Function Calling集成，确保计算精确
- **多行程支持**: 记账页面支持行程切换
- **智能统计**: 区分基金池与个人垫付统计

## [1.2.0] - 2025-08-27
### 🎨 界面优化
#### 新增功能
- **UI重构**: TripDetail页面操作按钮网格化布局
- **AI架构**: 模块化意图优先解析系统
- **虚拟成员**: 支持未注册用户参与计算
- **权限管理**: 基于角色的功能控制

## [1.1.0] - 2024-08
### 🤖 AI智能化
#### 新增功能
- AI智能记账：自然语言解析
- 成员看板：可视化成员财务状态
- 实时通信：WebSocket多人协作

## [1.0.0] - 2024-08
### 🎉 初始版本
#### 核心功能
- 基础记账功能
- 费用分摊计算
- 结算方案生成
- 移动端适配

---

格式说明：
- 🎯 主要功能
- 🎨 界面/UX
- 🤖 AI相关
- 🏗️ 架构改进
- 🔧 优化/重构
- 🐛 Bug修复
- 📦 部署/配置
- 📊 数据/统计
- 💰 财务功能
- 🔄 同步/实时
- 📚 文档
- 🧪 测试
- ✅ 已解决